#!/usr/sbin/nft -f
# Base nftables configuration template
# This file contains the common configuration shared between different examples

flush ruleset

table inet filter {
    # Prerouting chain - filters packets before routing decision
    chain prerouting {
        type filter hook prerouting priority 0;
        
        # Drop invalid connection states
        ct state invalid counter log prefix "Invalid Packets: " drop
        
        # Drop new connections without proper SYN flag
        tcp flags & (fin|syn|rst|ack) != syn ct state new counter log drop
    }

    # Input chain - filters incoming packets
    chain input {
        type filter hook input priority 0;
        
        # Accept any localhost traffic
        iif lo accept
        
        # Accept traffic originated from us (established/related connections)
        ct state established,related accept
        
        # SSH blocking rule - block specific IPs
        # Customize these IPs based on your needs
        tcp dport 22 ip saddr { 192.168.0.7, 192.168.0.10 } log prefix "Blocked SSH packets: " drop
        
        # Accept SSH and DNS on new connections
        tcp dport { 22, 53 } ct state new accept
        udp dport 53 ct state new accept
        
        # Accept ICMP error messages for IPv4
        ct state new,related,established icmp type { destination-unreachable, time-exceeded, parameter-problem } accept
        
        # Accept ICMPv6 error messages for IPv6
        # Recommended for IPv6-enabled networks - required for proper diagnostics and error handling
        ct state new,related,established icmpv6 type { destination-unreachable, time-exceeded, parameter-problem } accept
        
        # Accept IPv6 neighbor discovery - required for IPv6 connectivity
        ip6 nexthdr icmpv6 icmpv6 type { nd-neighbor-solicit, nd-router-advert, nd-neighbor-advert } accept
        
        # Default policy: count and drop any other traffic
        counter log prefix "Dropped packet: " drop
    }
}
